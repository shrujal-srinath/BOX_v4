<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basketball Game Manager Pro</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Self-contained styles for the Court View component */
        #radialMenu {
            position: fixed; width: 300px; height: 300px; pointer-events: none;
            transition: opacity 0.2s ease-out, transform 0.2s ease-out;
            z-index: 2000;
        }
        #radialMenu.hidden { opacity: 0; transform: scale(0.9); pointer-events: none; }

        .radial-btn {
            position: absolute; top: 50%; left: 50%; width: 90px; height: 90px;
            background: linear-gradient(145deg, rgba(255,255,255,0.95), rgba(245,245,245,0.95));
            color: #1f2937; border: 1px solid rgba(0,0,0,0.1); border-radius: 50%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15); pointer-events: all;
            transform: translate(-50%, -50%); backdrop-filter: blur(12px);
        }
        .radial-btn:hover { transform: translate(-50%, -50%) scale(1.1); box-shadow: 0 8px 25px rgba(0,0,0,0.2); }
        .radial-btn.make { border-color: #10b981; color: #059669; }
        .radial-btn.miss { border-color: #ef4444; color: #dc2626; }
        .radial-btn.play { border-color: #3b82f6; color: #2563eb; }
        .radial-btn .btn-icon { font-size: 2.2rem; line-height: 1; }
        .radial-btn .btn-label { font-size: 0.75rem; font-weight: 600; margin-top: 4px; text-align: center; line-height: 1.1; }

        .court-indicator {
            position: absolute; background-color: rgba(17, 24, 39, 0.9); color: white;
            padding: 8px 16px; border-radius: 9999px; font-size: 0.875rem; font-weight: 600;
            pointer-events: none; opacity: 0; transition: opacity 0.3s ease-in-out, transform 0.2s ease; backdrop-filter: blur(5px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .court-indicator.visible { opacity: 1; }
        #zoneIndicator { top: 10px; left: 10px; }
        #distanceIndicator { top: 10px; right: 10px; }
        
        #heatmapCanvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; transition: opacity 0.3s ease-in-out; }
        #heatmapCanvas.hidden { opacity: 0; }

        #selection-preview { pointer-events: none; transition: opacity 0.2s; }
        @keyframes pulse { 0%, 100% { transform: scale(1); opacity: 0.7; } 50% { transform: scale(1.1); opacity: 1; } }
        .pulse-animation { animation: pulse 1.2s infinite cubic-bezier(0.66, 0, 0.34, 1); }
        
        #settingsModal { transition: opacity 0.2s ease-in-out; }
        #settingsModal .transform { transition: transform 0.2s ease-in-out; }
        .shot-history-marker { 
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out; 
            cursor: pointer;
        }
        .shot-history-marker text {
            pointer-events: none;
        }
        .interactive-line {
            transition: all 0.2s ease-in-out;
        }
        .interactive-line:hover {
            stroke: #fbbf24 !important;
            filter: drop-shadow(0 0 8px #fbbf24);
        }
        [data-court-type="nba"] .interactive-line:hover {
            stroke-width: 5 !important;
        }
        [data-court-type="fiba"] .interactive-line:hover {
            stroke-width: 10 !important;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="app-header">
            <div class="nav-container">
                <h1 class="app-title">üèÄ Basketball Game Manager Pro</h1>
                <div class="nav-info">
                    <span class="game-code-display" id="currentGameCode"></span>
                    <button class="btn btn--sm btn--primary" id="exportBtn">üìä Export</button>
                </div>
            </div>
        </header>

        <!-- PAGE 1: HOME PAGE -->
        <div id="homePage" class="page active">
            <div class="container">
                <div class="home-content">
                    <div class="welcome-section">
                        <h2>Welcome to Basketball Game Manager Pro</h2>
                        <p>Create professional basketball games with advanced shot tracking and analytics.</p>
                    </div>
                    
                    <div class="home-grid">
                        <!-- Create Game Section -->
                        <div class="card home-card">
                            <div class="card__header">
                                <h3>üéÆ Create New Game</h3>
                            </div>
                            <div class="card__body">
                                <p>Start a new game as administrator with full control over settings and advanced shot tracking.</p>
                                
                                <div class="form-group">
                                    <label class="form-label">Game Name</label>
                                    <input type="text" class="form-control" id="newGameName" placeholder="Championship Game">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Admin Password</label>
                                    <input type="password" class="form-control" id="newGamePassword" placeholder="Enter admin password">
                                </div>
                                
                                <div class="game-code-preview">
                                    <label class="form-label">Your Game Code:</label>
                                    <div class="code-display" id="newGameCode">ABC123</div>
                                    <button class="btn btn--outline btn--sm" id="generateCodeBtn">Generate New Code</button>
                                </div>
                                <button class="btn btn--primary btn--full-width" id="createGameBtn">Create as Admin</button>
                            </div>
                        </div>

                        <!-- Join Game Section -->
                        <div class="card home-card">
                            <div class="card__header">
                                <h3>üîó Join Existing Game</h3>
                            </div>
                            <div class="card__body">
                                <div class="form-group">
                                    <label class="form-label">Enter Game Code</label>
                                    <input type="text" class="form-control" id="joinGameCode" placeholder="ABC123" maxlength="6">
                                </div>
                                <div class="form-group" id="passwordGroup" style="display: none;">
                                    <label class="form-label">Admin Password</label>
                                    <input type="password" class="form-control" id="joinPassword" placeholder="Enter admin password">
                                </div>
                                <div class="join-buttons">
                                    <button class="btn btn--primary" id="joinAdminBtn">Join as Admin</button>
                                    <button class="btn btn--secondary" id="joinViewerBtn">Join as Viewer</button>
                                </div>
                                <div class="error-message" id="joinError"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Active Games List -->
                    <div class="card active-games">
                        <div class="card__header">
                            <h3>Active Games</h3>
                            <button class="btn btn--sm btn--outline" id="refreshGamesBtn">Refresh</button>
                        </div>
                        <div class="card__body">
                            <div class="games-list" id="activeGamesList">
                                <div class="no-games">No active games found</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PAGE 2: GAME CONFIGURATION -->
        <div id="configPage" class="page">
            <div class="container">
                <div class="page-header">
                    <h2>Game Configuration</h2>
                    <div class="game-code-badge">Game Code: <span id="configGameCode">ABC123</span></div>
                </div>
                
                <div class="config-grid">
                    <!-- Game Details -->
                    <div class="card config-section">
                        <div class="card__header">
                            <h3>Game Details</h3>
                        </div>
                        <div class="card__body">
                            <div class="form-group">
                                <label class="form-label">Game Name</label>
                                <input type="text" class="form-control" id="gameName" placeholder="Championship Game">
                            </div>
                            
                            <div class="team-setup-grid">
                                <div class="team-config">
                                    <h4>Home Team</h4>
                                    <div class="form-group">
                                        <label class="form-label">Team Name</label>
                                        <input type="text" class="form-control" id="homeTeamName" value="Home Team">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Team Color</label>
                                        <select class="form-control" id="homeTeamColor">
                                            <option value="bg-1">Blue</option>
                                            <option value="bg-4">Red</option>
                                            <option value="bg-3">Green</option>
                                            <option value="bg-6">Orange</option>
                                            <option value="bg-5">Purple</option>
                                            <option value="bg-8">Cyan</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="team-config">
                                    <h4>Away Team</h4>
                                    <div class="form-group">
                                        <label class="form-label">Team Name</label>
                                        <input type="text" class="form-control" id="awayTeamName" value="Away Team">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Team Color</label>
                                        <select class="form-control" id="awayTeamColor">
                                            <option value="bg-4">Red</option>
                                            <option value="bg-1">Blue</option>
                                            <option value="bg-3">Green</option>
                                            <option value="bg-6">Orange</option>
                                            <option value="bg-5">Purple</option>
                                            <option value="bg-8">Cyan</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Game Settings -->
                    <div class="card config-section">
                        <div class="card__header">
                            <h3>Game Format</h3>
                        </div>
                        <div class="card__body">
                            <div class="form-group">
                                <label class="form-label">Game Format</label>
                                <select class="form-control" id="gameFormat">
                                    <option value="quarters">4 Quarters</option>
                                    <option value="halves">2 Halves</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Period Duration (minutes)</label>
                                <select class="form-control" id="periodDuration">
                                    <option value="8">8 minutes</option>
                                    <option value="10">10 minutes</option>
                                    <option value="12" selected>12 minutes</option>
                                    <option value="15">15 minutes</option>
                                    <option value="20">20 minutes</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Timeouts per Team</label>
                                <select class="form-control" id="timeoutsPerTeam">
                                    <option value="5">5 timeouts</option>
                                    <option value="6">6 timeouts</option>
                                    <option value="7" selected>7 timeouts</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Team Foul Limit</label>
                                <select class="form-control" id="foulLimit">
                                    <option value="5">5 fouls</option>
                                    <option value="6">6 fouls</option>
                                    <option value="7" selected>7 fouls</option>
                                    <option value="8">8 fouls</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="shotClockEnabled" checked>
                                    <span class="checkmark"></span>
                                    Enable Shot Clock (24 seconds)
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Game Type Selection -->
                <div class="game-type-section">
                    <h3>Select Game Type</h3>
                    <div class="game-type-cards">
                        <div class="game-type-card" data-type="practice">
                            <div class="game-type-icon">üèÉ</div>
                            <h4>Practice Game</h4>
                            <p>Simple scorekeeping without detailed player statistics. Perfect for scrimmages and practice sessions.</p>
                            <ul>
                                <li>Basic score tracking</li>
                                <li>Team fouls and timeouts</li>
                                <li>No individual player stats</li>
                                <li>Faster setup</li>
                            </ul>
                        </div>
                        
                        <div class="game-type-card selected" data-type="professional">
                            <div class="game-type-icon">üèÜ</div>
                            <h4>Professional Game</h4>
                            <p>Complete game management with detailed player statistics and advanced shot tracking features.</p>
                            <ul>
                                <li>Full player statistics</li>
                                <li>Interactive shot chart</li>
                                <li>Advanced analytics</li>
                                <li>Play-by-play recording</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="config-actions">
                    <button class="btn btn--outline" id="backToHomeBtn">Back to Home</button>
                    <button class="btn btn--primary btn--lg" id="continueConfigBtn">Continue</button>
                </div>
            </div>
        </div>

        <!-- PAGE 3: PLAYER SETUP -->
        <div id="playerSetupPage" class="page">
            <div class="container">
                <div class="page-header">
                    <h2>Player Setup</h2>
                    <div class="game-code-badge">Game Code: <span id="playerGameCode">ABC123</span></div>
                </div>

                <div class="player-setup-grid">
                    <!-- Home Team Players -->
                    <div class="card team-players">
                        <div class="card__header team-header home-team-header">
                            <h3 id="homeTeamPlayerTitle">Home Team Players</h3>
                        </div>
                        <div class="card__body">
                            <div class="add-player-form">
                                <div class="player-inputs">
                                    <input type="text" class="form-control" id="homePlayerName" placeholder="Player Name">
                                    <input type="number" class="form-control" id="homePlayerNumber" placeholder="#" min="0" max="99">
                                    <select class="form-control" id="homePlayerPosition">
                                        <option value="">Position</option>
                                        <option value="PG">PG - Point Guard</option>
                                        <option value="SG">SG - Shooting Guard</option>
                                        <option value="SF">SF - Small Forward</option>
                                        <option value="PF">PF - Power Forward</option>
                                        <option value="C">C - Center</option>
                                    </select>
                                </div>
                                <button class="btn btn--primary" id="addHomePlayerBtn">Add Player</button>
                            </div>
                            <div class="players-list" id="homePlayersList"></div>
                            <div class="team-status" id="homeTeamStatus">No players added</div>
                        </div>
                    </div>

                    <!-- Away Team Players -->
                    <div class="card team-players">
                        <div class="card__header team-header away-team-header">
                            <h3 id="awayTeamPlayerTitle">Away Team Players</h3>
                        </div>
                        <div class="card__body">
                            <div class="add-player-form">
                                <div class="player-inputs">
                                    <input type="text" class="form-control" id="awayPlayerName" placeholder="Player Name">
                                    <input type="number" class="form-control" id="awayPlayerNumber" placeholder="#" min="0" max="99">
                                    <select class="form-control" id="awayPlayerPosition">
                                        <option value="">Position</option>
                                        <option value="PG">PG - Point Guard</option>
                                        <option value="SG">SG - Shooting Guard</option>
                                        <option value="SF">SF - Small Forward</option>
                                        <option value="PF">PF - Power Forward</option>
                                        <option value="C">C - Center</option>
                                    </select>
                                </div>
                                <button class="btn btn--primary" id="addAwayPlayerBtn">Add Player</button>
                            </div>
                            <div class="players-list" id="awayPlayersList"></div>
                            <div class="team-status" id="awayTeamStatus">No players added</div>
                        </div>
                    </div>
                </div>

                <div class="setup-actions">
                    <button class="btn btn--outline" id="backToConfigBtn">Back to Config</button>
                    <button class="btn btn--primary btn--lg" id="startGameBtn" disabled>Start Game</button>
                </div>
            </div>
        </div>

        <!-- PAGE 4: GAME CONTROLLER -->
        <div id="controllerPage" class="page">
            <div class="container controller-container">
                <!-- REDESIGNED Digital Scoreboard -->
                <div class="digital-scoreboard-card">
                    <div class="card__body">
                        <!-- Header Row -->
                        <div class="scoreboard-header">
                            <span class="status status--info" id="gameStatusBadge">Setup</span>
                            <span class="period-display" id="periodDisplay">1st Quarter</span>
                            <span class="game-code-small">Code: <span id="controllerGameCode">ABC123</span></span>
                        </div>

                        <!-- Main Clocks Section -->
                        <div class="digital-clocks-section">
                            <div class="main-game-clock">
                                <div class="clock-label">Game Clock</div>
                                <div class="digital-clock-display game-time" id="gameClockDisplay">12:00</div>
                            </div>
                            <div class="shot-clock-section">
                                <div class="clock-label">Shot Clock</div>
                                <div class="digital-clock-display shot-time" id="shotClockDisplay">24</div>
                            </div>
                        </div>

                        <!-- Team Scores Section -->
                        <div class="team-scores-grid">
                            <div class="team-score-column">
                                <div class="team-name-display" id="homeTeamTitle">Home Team</div>
                                <div class="team-score-large" id="homeScore">0</div>
                                <div class="team-stats-row">
                                    <div class="stat-group">
                                        <span>Fouls</span>
                                        <div class="stat-controls">
                                            <button class="stat-btn stat-minus" data-team="home" data-stat="fouls">‚àí</button>
                                            <span class="stat-value" id="homeFouls">0</span>
                                            <button class="stat-btn stat-plus" data-team="home" data-stat="fouls">+</button>
                                        </div>
                                    </div>
                                    <div class="stat-group">
                                        <span>TO</span>
                                        <div class="stat-controls">
                                            <button class="stat-btn stat-minus" data-team="home" data-stat="timeouts">‚àí</button>
                                            <span class="stat-value" id="homeTimeouts">7</span>
                                            <button class="stat-btn stat-plus" data-team="home" data-stat="timeouts">+</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="vs-divider">VS</div>

                            <div class="team-score-column">
                                <div class="team-name-display" id="awayTeamTitle">Away Team</div>
                                <div class="team-score-large" id="awayScore">0</div>
                                <div class="team-stats-row">
                                    <div class="stat-group">
                                        <span>Fouls</span>
                                        <div class="stat-controls">
                                            <button class="stat-btn stat-minus" data-team="away" data-stat="fouls">‚àí</button>
                                            <span class="stat-value" id="awayFouls">0</span>
                                            <button class="stat-btn stat-plus" data-team="away" data-stat="fouls">+</button>
                                        </div>
                                    </div>
                                    <div class="stat-group">
                                        <span>TO</span>
                                        <div class="stat-controls">
                                            <button class="stat-btn stat-minus" data-team="away" data-stat="timeouts">‚àí</button>
                                            <span class="stat-value" id="awayTimeouts">7</span>
                                            <button class="stat-btn stat-plus" data-team="away" data-stat="timeouts">+</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Control Buttons -->
                        <div class="clock-control-buttons">
                            <button class="btn btn--primary" id="playPauseBtn">‚ñ∂Ô∏è Start</button>
                            <button class="btn btn--outline" id="resetClockBtn">Reset Clock</button>
                            <button class="btn btn--outline" id="resetShotClockBtn">Reset Shot</button>
                            <button class="btn btn--secondary" id="nextPeriodBtn">Next Period</button>
                            <button class="btn btn--secondary" id="viewGameBtn">üì∫ View</button>
                            <button class="btn btn--outline" id="endGameBtn">End Game</button>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Quick Stats Box -->
                <div class="card control-box quick-stats-box" id="quickStatsSection">
                    <div class="card__header">
                        <h3>Quick Stats Entry</h3>
                        <div class="team-player-selection">
                            <div class="team-tabs">
                                <button class="team-tab active" data-team="home" id="quickHomeTab">Home</button>
                                <button class="team-tab" data-team="away" id="quickAwayTab">Away</button>
                            </div>
                            <select class="form-control player-select" id="quickPlayerSelect">
                                <option value="">Select Player</option>
                            </select>
                        </div>
                    </div>
                    <div class="card__body">
                        <div class="stats-section">
                            <h4 class="stats-section-title">Scoring</h4>
                            <div class="quick-stats-scoring">
                                <button class="btn btn--sm btn--primary quick-stat-btn" data-stat="ft" data-points="1" data-key="1">+1 FT</button>
                                <button class="btn btn--sm btn--primary quick-stat-btn" data-stat="fg2" data-points="2" data-key="2">+2</button>
                                <button class="btn btn--sm btn--primary quick-stat-btn" data-stat="fg3" data-points="3" data-key="3">+3</button>
                            </div>
                        </div>
                        
                        <div class="stats-section">
                            <h4 class="stats-section-title">Stats & Fouls/TOs</h4>
                            <div class="quick-stats-grid">
                                <button class="btn btn--sm btn--outline quick-stat-btn" data-stat="rebound" data-key="R">Reb</button>
                                <button class="btn btn--sm btn--outline quick-stat-btn" data-stat="assist" data-key="A">Ast</button>
                                <button class="btn btn--sm btn--outline quick-stat-btn" data-stat="block" data-key="B">Blk</button>
                                <button class="btn btn--sm btn--outline quick-stat-btn" data-stat="steal" data-key="S">Stl</button>
                                <button class="btn btn--sm btn--success quick-stat-btn" data-stat="foul+" data-key="Shift+F">+Foul</button>
                                <button class="btn btn--sm btn--error quick-stat-btn" data-stat="foul-" data-key="F">-Foul</button>
                                <button class="btn btn--sm btn--success quick-stat-btn" data-stat="timeout+" data-key="Shift+T">+TO</button>
                                <button class="btn btn--sm btn--error quick-stat-btn" data-stat="timeout-" data-key="T">-TO</button>
                            </div>
                        </div>
                        
                        <div class="keyboard-shortcuts">
                            <div class="shortcuts-label">Keyboard Shortcuts:</div>
                            <div class="shortcuts-list">
                                <span>Space - Pause/Resume</span>
                                <span>Enter - Reset Shot Clock</span>
                                <span>? - Help</span>
                                <span>Ctrl+Z - Undo</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Court and Tabs Section -->
                <div class="court-tabs-section">
                    <div class="tabs-header">
                        <button class="tab-btn active" data-tab="court">Court</button>
                        <button class="tab-btn" data-tab="feed">Live Feed</button>
                        <button class="tab-btn" data-tab="analytics">Analytics</button>
                    </div>

                    <!-- Court Tab -->
                    <div class="tab-content active" id="courtTab">
                        <!-- Shot Controls -->
                        <div class="shot-controls" id="shotControls">
                            <div class="shot-player-selection">
                                <div class="team-player-selection">
                                    <div class="team-tabs">
                                        <button class="team-tab active" data-team="home" id="courtHomeTab">Home</button>
                                        <button class="team-tab" data-team="away" id="courtAwayTab">Away</button>
                                    </div>
                                    <select class="form-control player-select" id="courtPlayerSelect">
                                        <option value="">Select Player for Court Actions</option>
                                    </select>
                                </div>
                                <div class="undo-section">
                                    <button class="btn btn--sm btn--outline" id="undoShotBtn">‚Ü∂ Undo Last (Ctrl+Z)</button>
                                    <span class="shots-count" id="shotsCount">Actions: 0</span>
                                </div>
                            </div>
                        </div>

                        <!-- NEW INTEGRATED BASKETBALL COURT -->
                        <div id="court-wrapper" class="court-container relative w-full bg-gray-200 rounded-lg overflow-hidden">
                            <svg id="basketballCourt" class="absolute top-0 left-0 w-full h-full">
                                <rect id="court-background" width="100%" height="100%" fill="#D2A679"/>
                                <g id="court-markings"></g>
                                <g id="selection-preview"></g>
                                <g id="shotHistory"></g>
                            </svg>
                            <canvas id="heatmapCanvas" class="hidden"></canvas>
                            <div id="zoneIndicator" class="court-indicator"></div>
                            <div id="distanceIndicator" class="court-indicator"></div>
                        </div>
                    </div>

                    <!-- Live Feed Tab -->
                    <div class="tab-content" id="feedTab">
                        <div class="live-feed-container">
                            <h3>Live Game Feed</h3>
                            <div class="play-by-play" id="playByPlay">
                                <div class="feed-item">Game started - Select team and player, then click court for actions</div>
                            </div>
                        </div>
                    </div>

                    <!-- Analytics Tab -->
                    <div class="tab-content" id="analyticsTab">
                        <div class="analytics-container">
                            <h3>Game Analytics</h3>
                            <div class="analytics-grid" id="analyticsGrid">
                                <div class="stat-card">
                                    <h4>Team Shooting</h4>
                                    <div class="stat-value" id="teamShootingPct">0%</div>
                                </div>
                                <div class="stat-card">
                                    <h4>3-Point %</h4>
                                    <div class="stat-value" id="threePointPct">0%</div>
                                </div>
                                <div class="stat-card">
                                    <h4>Total Actions</h4>
                                    <div class="stat-value" id="totalShots">0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PAGE 5: VIEWER DISPLAY -->
        <div id="viewerPage" class="page">
            <div class="viewer-display">
                <!-- Main Scoreboard -->
                <div class="scoreboard">
                    <div class="team-section home-display">
                        <div class="team-name" id="viewerHomeName">Home Team</div>
                        <div class="team-score" id="viewerHomeScore">0</div>
                        <div class="team-info">
                            <div class="fouls-display">Fouls: <span id="viewerHomeFouls">0</span></div>
                            <div class="timeouts-display">TO: <span id="viewerHomeTimeouts">7</span></div>
                        </div>
                    </div>
                    
                    <div class="center-display">
                        <div class="game-clock-viewer">
                            <div class="period-viewer" id="viewerPeriod">1st Quarter</div>
                            <div class="time-display" id="viewerGameClock">12:00</div>
                            <div class="shot-clock-viewer">
                                <span>Shot Clock</span>
                                <span class="shot-time" id="viewerShotClock">24</span>
                            </div>
                        </div>
                    </div>

                    <div class="team-section away-display">
                        <div class="team-name" id="viewerAwayName">Away Team</div>
                        <div class="team-score" id="viewerAwayScore">0</div>
                        <div class="team-info">
                            <div class="fouls-display">Fouls: <span id="viewerAwayFouls">0</span></div>
                            <div class="timeouts-display">TO: <span id="viewerAwayTimeouts">7</span></div>
                        </div>
                    </div>
                </div>

                <!-- Game Status -->
                <div class="game-status-viewer">
                    <div class="status-badge" id="viewerStatus">Setup</div>
                    <div class="game-code-viewer">Code: <span id="viewerGameCode">ABC123</span></div>
                </div>

                <!-- Share Section -->
                <div class="share-section">
                    <button class="btn btn--outline" id="copyUrlBtn">üìã Copy URL</button>
                    <button class="btn btn--primary" id="viewerFullscreenBtn">üì∫ Fullscreen</button>
                    <button class="btn btn--secondary" id="backToControllerBtn">‚Üê Back to Controller</button>
                </div>
            </div>
        </div>

        <!-- Enhanced Export Modal -->
        <div id="exportModal" class="modal hidden" role="dialog" aria-labelledby="exportTitle" aria-modal="true">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="exportTitle">Enhanced Export Game Data</h3>
                    <button class="modal-close" aria-label="Close">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Choose from advanced export options with detailed player statistics and shot charts:</p>
                    <div class="export-options">
                        <div class="export-option" data-format="zip">
                            <div class="export-icon">üì¶</div>
                            <div class="export-details">
                                <h4>Complete Game Package (ZIP)</h4>
                                <p>Full game report PDF, individual player sheets with shot charts, CSV stats, and game data</p>
                            </div>
                        </div>
                        <div class="export-option" data-format="pdf">
                            <div class="export-icon">üìÑ</div>
                            <div class="export-details">
                                <h4>Game Summary PDF</h4>
                                <p>Complete game report with scores, team stats, and combined shot chart</p>
                            </div>
                        </div>
                        <div class="export-option" data-format="csv">
                            <div class="export-icon">üìä</div>
                            <div class="export-details">
                                <h4>Player Stats CSV</h4>
                                <p>Individual player statistics in spreadsheet format with shooting percentages</p>
                            </div>
                        </div>
                        <div class="export-option" data-format="json">
                            <div class="export-icon">üíæ</div>
                            <div class="export-details">
                                <h4>Complete Game Data</h4>
                                <p>Full game data in JSON format for backup, import, or advanced analysis</p>
                            </div>
                        </div>
                        <div class="export-option" data-format="png">
                            <div class="export-icon">üñºÔ∏è</div>
                            <div class="export-details">
                                <h4>Shot Chart Image</h4>
                                <p>High-resolution shot chart visualization as PNG image</p>
                            </div>
                        </div>
                    </div>
                    <div id="exportProgress" class="export-progress hidden">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="progress-text" id="progressText">Preparing export...</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--outline" id="cancelExportBtn">Cancel</button>
                    <button class="btn btn--primary" id="confirmExportBtn" disabled>Export Selected</button>
                </div>
            </div>
        </div>

        <!-- Keyboard Shortcuts Help Modal -->
        <div id="shortcutsModal" class="modal hidden" role="dialog" aria-labelledby="shortcutsTitle" aria-modal="true">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="shortcutsTitle">‚å®Ô∏è Keyboard Shortcuts</h3>
                    <button class="modal-close" aria-label="Close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="shortcuts-grid">
                        <div class="shortcut-section">
                            <h4>Game Control</h4>
                            <div class="shortcut-item"><kbd>Space</kbd> Pause/Resume both clocks</div>
                            <div class="shortcut-item"><kbd>Enter</kbd> Reset shot clock</div>
                            <div class="shortcut-item"><kbd>Ctrl+Z</kbd> Undo last action</div>
                            <div class="shortcut-item"><kbd>?</kbd> Show this help</div>
                        </div>
                        <div class="shortcut-section">
                            <h4>Quick Scoring</h4>
                            <div class="shortcut-item"><kbd>1</kbd> Free throw (+1)</div>
                            <div class="shortcut-item"><kbd>2</kbd> 2-pointer (+2)</div>
                            <div class="shortcut-item"><kbd>3</kbd> 3-pointer (+3)</div>
                        </div>
                        <div class="shortcut-section">
                            <h4>Stats</h4>
                            <div class="shortcut-item"><kbd>R</kbd> Rebound</div>
                            <div class="shortcut-item"><kbd>A</kbd> Assist</div>
                            <div class="shortcut-item"><kbd>B</kbd> Block</div>
                            <div class="shortcut-item"><kbd>S</kbd> Steal</div>
                        </div>
                        <div class="shortcut-section">
                            <h4>Fouls & Timeouts</h4>
                            <div class="shortcut-item"><kbd>Shift+F</kbd> Add foul</div>
                            <div class="shortcut-item"><kbd>F</kbd> Remove foul</div>
                            <div class="shortcut-item"><kbd>Shift+T</kbd> Add timeout</div>
                            <div class="shortcut-item"><kbd>T</kbd> Remove timeout</div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--primary" id="closeShortcutsBtn">Got it!</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Court View Modals and Menus -->
    <div id="radialMenu" class="radial-menu hidden"></div>
    <div id="settingsModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 hidden opacity-0 z-[1000]">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md p-6 transform scale-95">
            <div class="flex justify-between items-center border-b pb-3 mb-4">
                <h2 class="text-xl font-semibold">Court Settings</h2>
                <button id="closeSettingsBtn" class="p-2 rounded-full hover:bg-gray-200">&times;</button>
            </div>
            <div class="space-y-6">
                 <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Court Type</label>
                    <div id="courtTypeToggle" class="flex rounded-lg shadow-sm">
                        <button data-type="nba" class="court-type-btn w-1/2 px-4 py-2 rounded-l-md border">NBA</button>
                        <button data-type="fiba" class="court-type-btn w-1/2 px-4 py-2 -ml-px border">FIBA</button>
                    </div>
                </div>
                <div class="flex items-center justify-between">
                    <label for="showGhostToggle" class="text-sm font-medium text-gray-700">Show Preview Marker</label>
                    <button id="showGhostToggle" type="button" class="bg-green-500 relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors" role="switch"><span class="translate-x-5 pointer-events-none h-5 w-5 transform rounded-full bg-white shadow ring-0 transition"></span></button>
                </div>
                 <div class="flex items-center justify-between">
                    <label for="fadeShotToggle" class="text-sm font-medium text-gray-700">Auto-Fade Previous Shot</label>
                    <button id="fadeShotToggle" type="button" class="bg-gray-200 relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors" role="switch"><span class="translate-x-0 pointer-events-none h-5 w-5 transform rounded-full bg-white shadow ring-0 transition"></span></button>
                </div>
                <div class="flex items-center justify-between">
                    <label for="heatmapToggle" class="text-sm font-medium text-gray-700">Heatmap Mode</label>
                    <button id="heatmapToggle" type="button" class="bg-gray-200 relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors" role="switch"><span class="translate-x-0 pointer-events-none h-5 w-5 transform rounded-full bg-white shadow ring-0 transition"></span></button>
                </div>
                <div>
                    <label for="heatmapOpacity" class="block text-sm font-medium text-gray-700">Heatmap Opacity</label>
                    <input id="heatmapOpacity" type="range" min="0.1" max="1" step="0.1" value="0.7" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer mt-2">
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
